{"ast":null,"code":"import React,{Component}from'react';import'../../css/ws.css';//import { useNavigate, withRouter } from 'react-router-dom'\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const ws=new WebSocket('ws://104.128.95.54:3030/websockets/test');window.addEventListener('scroll',()=>{var h=window.innerHeight;var j=document.documentElement.scrollHeight;var k=document.documentElement.scrollTop;if(h+k>=j-150){console.log('add scroll');}});window.onload=function(){console.log('onload');};class Websocket extends Component{constructor(props){super(props);this.handleClick=this.handleClick.bind(this);this.state={apiResponse:\"\"};}callAPI(){fetch(\"http://104.128.95.54:9000/testAPI\").then(res=>res.text()).then(res=>this.setState({apiResponse:res})).then(err=>err);}componentDidMount(){this.callAPI();console.log('componentDidMount');ws.onopen=e=>{console.log('WebSocket 连接状态： '+ws.readyState);};ws.onmessage=data=>{const receiveBox=document.getElementById('receive-box');if(receiveBox!=null){receiveBox.innerHTML+='<p>'+data.data+'</p>';receiveBox.scrollTo({top:receiveBox.scrollHeight,behavior:\"smooth\"});}};document.getElementById('send-btn').addEventListener('click',this.startClick);document.getElementById('exit').addEventListener('click',this.handleClick);}componentWillMount(){console.log('componentWillMount');}componentWillUnmount(){console.log('componentWillUnmount');}handleClick(){ws.close();console.log('handleClick close');}startClick(){console.log('startState:'+ws.state);if(ws.readyState===1){console.log('1111111');const msgBox=document.getElementById('msg-need-send');ws.send(msgBox.value);console.log('startMsgBox:'+msgBox.value);}else{console.log('2222222');window.location.reload();}}render(){return/*#__PURE__*/_jsxs(\"div\",{className:\"websocket\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"receive\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\u670D\\u52A1\\u7AEF\\u8FD4\\u56DE\\u7684\\u6D88\\u606F\"}),/*#__PURE__*/_jsx(\"div\",{id:\"receive-box\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"send\",children:[/*#__PURE__*/_jsx(\"textarea\",{type:\"text\",id:\"msg-need-send\",defaultValue:\"777\"}),/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"button\",{id:\"send-btn\",children:\"\\u70B9\\u51FB\\u53D1\\u6D88\\u606F\\u7ED9\\u670D\\u52A1\\u7AEF\"})})]}),/*#__PURE__*/_jsx(\"button\",{id:\"exit\",children:\"\\u5173\\u95ED\\u8FDE\\u63A5\"})]});}}export default Websocket;","map":{"version":3,"names":["React","Component","jsx","_jsx","jsxs","_jsxs","ws","WebSocket","window","addEventListener","h","innerHeight","j","document","documentElement","scrollHeight","k","scrollTop","console","log","onload","Websocket","constructor","props","handleClick","bind","state","apiResponse","callAPI","fetch","then","res","text","setState","err","componentDidMount","onopen","e","readyState","onmessage","data","receiveBox","getElementById","innerHTML","scrollTo","top","behavior","startClick","componentWillMount","componentWillUnmount","close","msgBox","send","value","location","reload","render","className","children","id","type","defaultValue"],"sources":["/home/test01/websocketWithRabbitMQ/client/src/views/websocket/index.jsx"],"sourcesContent":["import React, { Component } from 'react';\nimport '../../css/ws.css'\n//import { useNavigate, withRouter } from 'react-router-dom'\n\nconst ws = new WebSocket('ws://104.128.95.54:3030/websockets/test');\n\nwindow.addEventListener('scroll', () => { \n  var h = window.innerHeight;\n  var j = document.documentElement.scrollHeight;\n  var k = document.documentElement.scrollTop;\n  if ((h + k) >= j - 150) {\n      console.log('add scroll');\n  }\n});\n\nwindow.onload= function(){\n  console.log('onload');\n}\n\nclass Websocket extends Component {\n  \n    constructor(props) {\n      super(props);\n      this.handleClick = this.handleClick.bind(this);\n      this.state = { apiResponse: \"\" };\n    }\n\n    callAPI() {\n        fetch(\"http://104.128.95.54:9000/testAPI\")\n            .then(res => res.text())\n            .then(res => this.setState({ apiResponse: res }))\n            .then(err => err);\n    }\n  \n    componentDidMount() {\n      \n        this.callAPI();\n        console.log('componentDidMount');\n\n        ws.onopen = e => {\n          console.log('WebSocket 连接状态： ' + ws.readyState)\n        }\n        \n        ws.onmessage = data => {\n          const receiveBox = document.getElementById('receive-box');\n\n          if(receiveBox != null){\n            receiveBox.innerHTML += '<p>' + data.data + '</p>'\n            receiveBox.scrollTo({\n              top: receiveBox.scrollHeight,\n              behavior: \"smooth\"\n            })\n          }\n        }\n\n        document.getElementById('send-btn').addEventListener('click',this.startClick);\n        document.getElementById('exit').addEventListener('click',this.handleClick);\n\n    }\n\n    componentWillMount () {\n      console.log('componentWillMount');\n    }\n\n    componentWillUnmount () {\n      console.log('componentWillUnmount');\n    }\n\n\n    handleClick() {\n      ws.close();\n      console.log('handleClick close');\n    } \n\n    startClick() {\n\n        console.log('startState:'+ws.state);\n\n          if(ws.readyState===1){\n            console.log('1111111')\n            const msgBox = document.getElementById('msg-need-send');\n            ws.send(msgBox.value);\n            console.log('startMsgBox:'+msgBox.value);\n          }else{\n            console.log('2222222');\n            window.location.reload();\n          }\n    } \n\n    render(){\n        return (\n          <div className=\"websocket\">\n            <div className=\"receive\">\n              <p>服务端返回的消息</p>\n              <div id=\"receive-box\"/>\n            </div>\n            <div className=\"send\">\n              <textarea type=\"text\" id=\"msg-need-send\" defaultValue={\"777\"} />\n              <p>\n                <button id=\"send-btn\">点击发消息给服务端</button> \n              </p>\n            </div>\n            <button id=\"exit\">关闭连接</button>\n        </div>\n        );\n      }\n    }\n\nexport default Websocket"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}